            adjustModelTransform(model) {
                const box = new THREE.Box3().setFromObject(model);
                const size = box.getSize(new THREE.Vector3());
                const maxSize = Math.max(size.x, size.y, size.z);
                const scale = 4 / maxSize;
                model.scale.multiplyScalar(scale);
                
                // ä¸­å¤®é…ç½®
                box.setFromObject(model);
                const center = box.getCenter(new THREE.Vector3());
                model.position.sub(center);
            }
            
            toggleAutoRotate() {
                this.autoRotate = !this.autoRotate;
                const btn = document.getElementById('autoRotateBtn');
                if (this.autoRotate) {
                    btn.classList.add('active');
                    btn.innerHTML = 'â¸ï¸ åœæ­¢';
                } else {
                    btn.classList.remove('active');
                    btn.innerHTML = 'ğŸ”„ è‡ªå‹•å›è»¢';
                }
            }
            
            resetCamera() {
                this.camera.position.set(6, 4, 6);
                this.camera.lookAt(0, 0, 0);
                if (this.currentModel) {
                    this.currentModel.rotation.set(0, 0, 0);
                }
            }
            
            toggleWireframe() {
                this.wireframeMode = !this.wireframeMode;
                const btn = document.getElementById('wireframeBtn');
                
                if (this.currentModel) {
                    this.currentModel.traverse((child) => {
                        if (child.isMesh) {
                            child.material.wireframe = this.wireframeMode;
                        }
                    });
                }
                
                if (this.wireframeMode) {
                    btn.classList.add('active');
                    btn.innerHTML = 'ğŸ¨ ã‚½ãƒªãƒƒãƒ‰';
                } else {
                    btn.classList.remove('active');
                    btn.innerHTML = 'ğŸ“ ãƒ¯ã‚¤ãƒ¤ãƒ¼';
                }
            }
            
            async switchModel() {
                this.currentModelIndex = (this.currentModelIndex + 1) % this.modelFiles.length;
                await this.loadModel(this.modelFiles[this.currentModelIndex]);
            }
            
            switchLighting() {
                this.currentLightingMode = (this.currentLightingMode + 1) % this.lightingModes.length;
                const mode = this.lightingModes[this.currentLightingMode];
                
                this.directionalLight.intensity = mode.intensity;
                this.directionalLight.color.setHex(mode.color);
                this.rimLight.intensity = mode.intensity * 0.5;
                
                const btn = document.getElementById('lightingBtn');
                btn.innerHTML = `ğŸ’¡ ${mode.name}`;
            }
            
            handleResize() {
                this.camera.aspect = window.innerWidth / window.innerHeight;
                this.camera.updateProjectionMatrix();
                this.renderer.setSize(window.innerWidth, window.innerHeight);
            }
            
            showLoading(text) {
                document.getElementById('loadingOverlay').style.display = 'flex';
                document.getElementById('loadingText').textContent = text;
                document.getElementById('loadingProgressBar').style.width = '0%';
            }
            
            hideLoading() {
                setTimeout(() => {
                    document.getElementById('loadingOverlay').style.opacity = '0';
                    setTimeout(() => {
                        document.getElementById('loadingOverlay').style.display = 'none';
                        document.getElementById('loadingOverlay').style.opacity = '1';
                    }, 500);
                }, 300);
            }
            
            updateLoadingProgress(percent) {
                document.getElementById('loadingProgressBar').style.width = `${percent}%`;
            }
            
            updatePerformanceStats() {
                this.stats.frameCount++;
                const now = performance.now();
                
                if (now >= this.stats.lastTime + 1000) {
                    this.stats.fps = Math.round((this.stats.frameCount * 1000) / (now - this.stats.lastTime));
                    this.stats.frameCount = 0;
                    this.stats.lastTime = now;
                    
                    // FPSè¡¨ç¤ºæ›´æ–°
                    const fpsElement = document.getElementById('fpsCounter');
                    if (fpsElement) {
                        fpsElement.textContent = this.stats.fps;
                        
                        // FPS ã«å¿œã˜ã¦è‰²ã‚’å¤‰æ›´
                        if (this.stats.fps >= 50) {
                            fpsElement.style.color = '#90EE90';
                        } else if (this.stats.fps >= 30) {
                            fpsElement.style.color = '#FFA500';
                        } else {
                            fpsElement.style.color = '#FF6347';
                        }
                    }
                    
                    // ãƒãƒªã‚´ãƒ³æ•°è¡¨ç¤º
                    const polygonElement = document.getElementById('polygonCounter');
                    if (polygonElement && this.currentModel) {
                        let triangles = 0;
                        this.currentModel.traverse((child) => {
                            if (child.isMesh && child.geometry) {
                                triangles += child.geometry.attributes.position.count / 3;
                            }
                        });
                        polygonElement.textContent = Math.round(triangles).toLocaleString();
                    }
                    
                    // æç”»ã‚³ãƒ¼ãƒ«æ•°è¡¨ç¤º
                    const drawCallElement = document.getElementById('drawCallCounter');
                    if (drawCallElement) {
                        drawCallElement.textContent = this.renderer.info.render.calls;
                    }
                }
            }
            
            startAnimationLoop() {
                const animate = () => {
                    requestAnimationFrame(animate);
                    
                    // è‡ªå‹•å›è»¢
                    if (this.autoRotate && this.currentModel) {
                        this.currentModel.rotation.y += 0.01 * this.rotationSpeed;
                        this.currentModel.rotation.x += 0.005 * this.rotationSpeed;
                    }
                    
                    // ã‚«ãƒ¡ãƒ©ã®è»½å¾®ãªæµ®éŠåŠ¹æœ
                    const time = Date.now() * 0.001;
                    this.camera.position.y += Math.sin(time * 0.5) * 0.01;
                    
                    // ç…§æ˜ã®å‹•çš„åŠ¹æœ
                    if (this.directionalLight) {
                        this.directionalLight.position.x = Math.sin(time * 0.3) * 2 + 10;
                        this.directionalLight.position.z = Math.cos(time * 0.3) * 2 + 5;
                    }
                    
                    // ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
                    this.renderer.render(this.scene, this.camera);
                    
                    // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹çµ±è¨ˆæ›´æ–°
                    this.updatePerformanceStats();
                };
                
                animate();
            }
        }
        
        // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', () => {
            // äº’æ›æ€§ãƒã‚§ãƒƒã‚¯
            if (!window.WebGLRenderingContext) {
                alert('ãŠä½¿ã„ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯WebGLã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“ã€‚');
                return;
            }
            
            // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ã®ãŸã‚ã®è¨­å®š
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('/sw.js').catch(() => {
                    // Service Worker ã®ç™»éŒ²å¤±æ•—ã¯ç„¡è¦–
                });
            }
            
            // ãƒ‡ãƒã‚¤ã‚¹åˆ¥æœ€é©åŒ–
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            if (isMobile) {
                document.body.classList.add('mobile-device');
                // ãƒ¢ãƒã‚¤ãƒ«ç”¨æœ€é©åŒ–
                document.getElementById('performancePanel').style.display = 'none';
            }
            
            // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹
            window.sudachiViewer = new SudachiViewer();
            
            // ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
            window.addEventListener('error', (e) => {
                console.error('ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼:', e.error);
            });
            
            // ãƒ‡ãƒãƒƒã‚°æƒ…å ±ï¼ˆé–‹ç™ºç”¨ï¼‰
            if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
                console.log('ğŸƒ ã‚¹ãƒ€ãƒ 3D ãƒ“ãƒ¥ãƒ¼ãƒ¯ãƒ¼ - ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰');
                console.log('Three.js ãƒãƒ¼ã‚¸ãƒ§ãƒ³:', THREE.REVISION);
                console.log('WebGL ãƒãƒ¼ã‚¸ãƒ§ãƒ³:', window.sudachiViewer?.renderer?.getContext().getParameter(window.sudachiViewer.renderer.getContext().VERSION));
            }
        });
        
        // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
        function isMobileDevice() {
            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        }
        
        function getWebGLSupport() {
            try {
                const canvas = document.createElement('canvas');
                return !!(window.WebGLRenderingContext && canvas.getContext('webgl'));
            } catch (e) {
                return false;
            }
        }
        
        // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ
        document.addEventListener('keydown', (e) => {
            if (!window.sudachiViewer) return;
            
            switch(e.key.toLowerCase()) {
                case 'r':
                    e.preventDefault();
                    window.sudachiViewer.resetCamera();
                    break;
                case 'w':
                    e.preventDefault();
                    window.sudachiViewer.toggleWireframe();
                    break;
                case 'a':
                    e.preventDefault();
                    window.sudachiViewer.toggleAutoRotate();
                    break;
                case 'm':
                    e.preventDefault();
                    window.sudachiViewer.switchModel();
                    break;
                case 'l':
                    e.preventDefault();
                    window.sudachiViewer.switchLighting();
                    break;
                case ' ':
                    e.preventDefault();
                    window.sudachiViewer.toggleAutoRotate();
                    break;
            }
        });
        
        // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°
        if ('performance' in window) {
            window.addEventListener('load', () => {
                setTimeout(() => {
                    const loadTime = performance.timing.loadEventEnd - performance.timing.navigationStart;
                    console.log(`ğŸš€ ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚é–“: ${loadTime}ms`);
                }, 0);
            });
        }
    </script>
</body>
</html>